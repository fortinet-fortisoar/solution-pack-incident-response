{
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "Hunt Sunburst IOCs",
    "aliasName": null,
    "tag": null,
    "description": "Download IOCs from the threat intelligence feeds and hunt them.",
    "isActive": true,
    "debug": false,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [],
    "synchronous": false,
    "lastModifyDate": 1636537406,
    "collection": "\/api\/3\/workflow_collections\/e2c1a8f3-00dc-4e82-a9f0-5e9957529407",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/1d88a68a-c865-4d62-9e1d-c5e1b87e2591",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "route": "64c9d294-b616-479c-aaf3-a27b8be16822",
                "title": "Sunburst IOC Hunt",
                "resources": [
                    "hunt"
                ],
                "inputVariables": [],
                "step_variables": {
                    "input": {
                        "records": "{{vars.input.records}}"
                    }
                },
                "displayConditions": {
                    "hunt": {
                        "sort": [],
                        "limit": 30,
                        "logic": "AND",
                        "filters": []
                    },
                    "alerts": {
                        "sort": [],
                        "limit": 30,
                        "logic": "AND",
                        "filters": []
                    }
                },
                "executeButtonText": "Execute",
                "noRecordExecution": false,
                "singleRecordExecution": true
            },
            "status": null,
            "top": "30",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/f414d039-bb0d-4e59-9c39-a8f1e880b18a",
            "uuid": "1d88a68a-c865-4d62-9e1d-c5e1b87e2591",
            "id": 2328
        },
        {
            "@type": "WorkflowStep",
            "name": "Configuration",
            "description": null,
            "arguments": {
                "to_email": "suyogjinturkar@gmail.com",
                "demo_iocs": "['d0d626deb3f9484e649294a8dfa814c5568f846d5aa02d4cdad5d041a29d5600','13.59.205.66','avsvmcloud.com']",
                "useMockOutput": "{{globalVars.Demo_mode}}",
                "sunburst_ioc_urls": "['https:\/\/raw.githubusercontent.com\/sophos-cybersecurity\/solarwinds-threathunt\/master\/iocs.csv']"
            },
            "status": null,
            "top": "165",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "uuid": "182526de-8f46-4e62-a7fd-ec2d0e3795e8",
            "id": 2329
        },
        {
            "@type": "WorkflowStep",
            "name": "Hunt Sunburst IOCs",
            "description": null,
            "arguments": {
                "message": {
                    "tags": [],
                    "type": "\/api\/3\/picklists\/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                    "tenant": "",
                    "content": "Sunburst IOCs hunt completed",
                    "records": "{{vars.input.records[0]['@id']}}"
                },
                "for_each": {
                    "item": "{{vars.steps.Create_Indicators}}",
                    "__bulk": false,
                    "parallel": false,
                    "condition": ""
                },
                "arguments": {
                    "indicator_iri": "{{vars.item['@id']}}",
                    "indicator_type": "{{vars.item.typeofindicator.itemValue}}",
                    "indicator_value": "{{vars.item.value}}"
                },
                "apply_async": false,
                "step_variables": [],
                "workflowReference": "\/api\/3\/workflows\/e8cfec1f-845e-4f90-ac51-6439b30495f3"
            },
            "status": null,
            "top": "705",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "uuid": "c2dcd299-db00-40c7-bcba-7068ce37e7ee",
            "id": 2330
        },
        {
            "@type": "WorkflowStep",
            "name": "Download IOCs CSV File",
            "description": null,
            "arguments": {
                "params": {
                    "url": "{{vars.item}}",
                    "password": "",
                    "username": "",
                    "request_headers": ""
                },
                "message": {
                    "tags": [],
                    "type": "\/api\/3\/picklists\/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                    "tenant": "",
                    "content": "Downloading Sunburst IOCs",
                    "records": "{{vars.input.records[0]['@id']}}"
                },
                "version": "3.0.5",
                "for_each": {
                    "item": "{{vars.sunburst_ioc_urls}}",
                    "condition": ""
                },
                "connector": "cyops_utilities",
                "operation": "download_file_from_url",
                "operationTitle": "File: Download File from URL",
                "step_variables": []
            },
            "status": null,
            "top": "300",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/0109f35d-090b-4a2b-bd8a-94cbc3508562",
            "uuid": "4032d19b-e2ff-4541-a9c6-d53dc207841c",
            "id": 2331
        },
        {
            "@type": "WorkflowStep",
            "name": "Convert IOC CSV to JSON",
            "description": null,
            "arguments": {
                "params": {
                    "type": "filepath",
                    "file_name": "{{vars.steps.Download_IOCs_CSV_File[0].data['cyops_file_path']}}",
                    "file_type": "CSV"
                },
                "version": "3.0.5",
                "connector": "cyops_utilities",
                "operation": "convert_to_json",
                "operationTitle": "Utils: Convert XML, CSV, XLS or XLSX Files to Dictionary",
                "step_variables": []
            },
            "status": null,
            "top": "435",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/0109f35d-090b-4a2b-bd8a-94cbc3508562",
            "uuid": "da91461c-0bd3-4c90-9c66-ab67218e6530",
            "id": 2332
        },
        {
            "@type": "WorkflowStep",
            "name": "Create Indicators",
            "description": null,
            "arguments": {
                "message": {
                    "tags": [],
                    "type": "\/api\/3\/picklists\/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                    "tenant": "",
                    "content": "Hunting Sunburst IOCs",
                    "records": "{{vars.input.records[0]['@id']}}"
                },
                "for_each": {
                    "item": "{{vars.steps.Convert_IOC_CSV_to_JSON.data}}",
                    "__bulk": true,
                    "condition": "{{vars.item.Note != \"\"}}",
                    "batch_size": 100
                },
                "resource": {
                    "tlp": {
                        "id": 314,
                        "@id": "\/api\/3\/picklists\/7bff95b7-6438-4b01-b23a-0fe8cb5b33d3",
                        "icon": null,
                        "uuid": "7bff95b7-6438-4b01-b23a-0fe8cb5b33d3",
                        "@type": "Picklist",
                        "color": "#FFBF00",
                        "display": "Amber",
                        "@context": "\/api\/3\/contexts\/Picklist",
                        "listName": "\/api\/3\/picklist_names\/40f1345f-f679-43c0-9237-5b06edd8385f",
                        "itemValue": "Amber",
                        "orderIndex": 1
                    },
                    "value": "{{vars.item.Data}}",
                    "__replace": "true",
                    "description": "{{vars.item.Note}}",
                    "indicatorStatus": {
                        "id": 369,
                        "@id": "\/api\/3\/picklists\/2f5cff61-fbff-4bb3-96be-302b78a9fb47",
                        "icon": null,
                        "@type": "Picklist",
                        "color": null,
                        "display": "TBD",
                        "@context": "\/api\/3\/contexts\/Picklist",
                        "listName": "\/api\/3\/picklist_names\/e6639d57-94a9-432f-a46f-b2b530402077",
                        "itemValue": "TBD",
                        "orderIndex": 3
                    },
                    "typeofindicator": "{%if vars.item.Indicator_type == \"domain\"%}{{\"IndicatorType\" | picklist(\"Domain\", \"@id\")}}{%elif vars.item.Indicator_type == \"ip\"%}{{\"IndicatorType\" | picklist(\"IP Address\", \"@id\")}}{%elif vars.item.Indicator_type == \"sha256\"%}{{\"IndicatorType\" | picklist(\"FileHash-SHA256\", \"@id\")}}{%else%}None{%endif%}"
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "\/api\/3\/upsert\/indicators",
                "__recommend": [],
                "fieldOperation": {
                    "recordTags": "Overwrite"
                },
                "step_variables": []
            },
            "status": null,
            "top": "560",
            "left": "120",
            "stepType": "\/api\/3\/workflow_step_types\/2597053c-e718-44b4-8394-4d40fe26d357",
            "uuid": "65dcb4f3-dd15-4931-978a-1c4e6eec27fb",
            "id": 2333
        },
        {
            "@type": "WorkflowStep",
            "name": "Create Alert",
            "description": null,
            "arguments": {
                "for_each": {
                    "item": "{{vars.steps.Hunt_Sunburst_IOCs}}",
                    "__bulk": true,
                    "condition": "{{((vars.item.ioc_found) and (vars.item.indicator_value in vars.demo_iocs)) if (vars.useMockOutput) else true}}"
                },
                "resource": {
                    "name": "Sunburst IOC Found - {{vars.item.indicator_type}} - {{vars.item.indicator_value}}",
                    "type": {
                        "id": 323,
                        "@id": "\/api\/3\/picklists\/58a405d1-542e-418d-80fa-3c5d2e12484f",
                        "icon": null,
                        "@type": "Picklist",
                        "color": null,
                        "display": "Sunbrust",
                        "listName": "\/api\/3\/picklist_names\/a7087b9c-5660-495f-a8ac-c3b198ddb8c2",
                        "itemValue": "Sunbrust",
                        "orderIndex": 24
                    },
                    "domain": "{%if vars.item.indicator_type == \"Domain\"%}{{vars.item.indicator_value}}{%endif%}",
                    "status": {
                        "id": 318,
                        "@id": "\/api\/3\/picklists\/7de816ff-7140-4ee5-bd05-93ce22002146",
                        "icon": null,
                        "@type": "Picklist",
                        "color": null,
                        "display": "Open",
                        "@context": "\/api\/3\/contexts\/Picklist",
                        "listName": "\/api\/3\/picklist_names\/33e964a9-d607-49f2-813c-7ce46141815a",
                        "itemValue": "Open",
                        "orderIndex": 1
                    },
                    "fileHash": "{%if vars.item.indicator_type == \"FileHash-SHA256\"%}{{vars.item.indicator_value}}{%endif%}",
                    "sourceIp": "{%if vars.item.indicator_type == \"IP Address\"%}{{vars.item.indicator_value}}{%endif%}",
                    "__replace": "true",
                    "ackSlaStatus": {
                        "id": 306,
                        "@id": "\/api\/3\/picklists\/72979f64-e8b9-4888-a965-957e0ec24818",
                        "icon": null,
                        "@type": "Picklist",
                        "color": "#808080",
                        "display": "Awaiting Action",
                        "@context": "\/api\/3\/contexts\/Picklist",
                        "listName": "\/api\/3\/picklist_names\/fe36a8f2-fcba-4221-b4ab-1081f596b153",
                        "itemValue": "Awaiting Action",
                        "orderIndex": 2
                    },
                    "closureReason": {
                        "id": 251,
                        "@id": "\/api\/3\/picklists\/8590c81e-3307-4645-97f5-c3e1bec4e05a",
                        "icon": null,
                        "@type": "Picklist",
                        "color": null,
                        "display": "Tasks Completed",
                        "@context": "\/api\/3\/contexts\/Picklist",
                        "listName": "\/api\/3\/picklist_names\/4ebacea1-88cd-4ea8-9dcc-385bea42cc59",
                        "itemValue": "Tasks Completed",
                        "orderIndex": 0
                    },
                    "respSlaStatus": {
                        "id": 306,
                        "@id": "\/api\/3\/picklists\/72979f64-e8b9-4888-a965-957e0ec24818",
                        "icon": null,
                        "@type": "Picklist",
                        "color": "#808080",
                        "display": "Awaiting Action",
                        "@context": "\/api\/3\/contexts\/Picklist",
                        "listName": "\/api\/3\/picklist_names\/fe36a8f2-fcba-4221-b4ab-1081f596b153",
                        "itemValue": "Awaiting Action",
                        "orderIndex": 2
                    },
                    "priorityWeight": 1,
                    "escalatedtoincident": {
                        "id": 31,
                        "@id": "\/api\/3\/picklists\/2128a09c-153d-4db3-985d-de6be33deae5",
                        "icon": null,
                        "@type": "Picklist",
                        "color": "#808080",
                        "display": "No",
                        "@context": "\/api\/3\/contexts\/Picklist",
                        "listName": "\/api\/3\/picklist_names\/e131cc54-9ae4-43c9-b830-af6e331fe024",
                        "itemValue": "No",
                        "orderIndex": 1
                    }
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "\/api\/3\/upsert\/alerts",
                "fieldOperation": {
                    "recordTags": "Overwrite"
                },
                "step_variables": []
            },
            "status": null,
            "top": "840",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/2597053c-e718-44b4-8394-4d40fe26d357",
            "uuid": "a05be9a3-f456-4619-88c4-79d83ce5d92c",
            "id": 2334
        },
        {
            "@type": "WorkflowStep",
            "name": "Create Communication Record",
            "description": null,
            "arguments": {
                "resource": {
                    "to": "{{vars.to_email}}",
                    "type": {
                        "id": 279,
                        "@id": "\/api\/3\/picklists\/b8e7c917-5299-4a43-9c1a-fac1d9a5438f",
                        "icon": null,
                        "@type": "Picklist",
                        "color": null,
                        "display": "Email",
                        "listName": "\/api\/3\/picklist_names\/57d30379-dbba-4684-b126-ec3ad8766f06",
                        "itemValue": "Email",
                        "orderIndex": 0
                    },
                    "hunts": "{{vars.input.records[0]['@id']}}",
                    "subject": "Sunburst IOCs Found",
                    "__replace": "",
                    "recordTags": [
                        "\/api\/3\/tags\/sunburst"
                    ],
                    "msgDirection": {
                        "id": 275,
                        "@id": "\/api\/3\/picklists\/9f0a2594-2390-4086-9b6f-c7165c70ce27",
                        "icon": null,
                        "@type": "Picklist",
                        "color": null,
                        "display": "Sending",
                        "listName": "\/api\/3\/picklist_names\/09b97c81-669a-4ac8-8668-920913f3329b",
                        "itemValue": "Sending",
                        "orderIndex": 3
                    }
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "\/api\/3\/communication",
                "fieldOperation": {
                    "recordTags": "Overwrite"
                },
                "step_variables": []
            },
            "status": null,
            "top": "975",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/2597053c-e718-44b4-8394-4d40fe26d357",
            "uuid": "f01efd3c-2681-44d5-abc8-c2f7223cdff7",
            "id": 2335
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "Download IOCs File -> Parse IOC CSV File",
            "targetStep": "\/api\/3\/workflow_steps\/da91461c-0bd3-4c90-9c66-ab67218e6530",
            "sourceStep": "\/api\/3\/workflow_steps\/4032d19b-e2ff-4541-a9c6-d53dc207841c",
            "label": null,
            "isExecuted": false,
            "uuid": "566ec121-51ca-4c25-8d46-961a9b6c20f5"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Create Indicators -> Hunt Sunburst IOCs",
            "targetStep": "\/api\/3\/workflow_steps\/c2dcd299-db00-40c7-bcba-7068ce37e7ee",
            "sourceStep": "\/api\/3\/workflow_steps\/65dcb4f3-dd15-4931-978a-1c4e6eec27fb",
            "label": null,
            "isExecuted": false,
            "uuid": "bef5ba55-10b9-4487-887a-8a64acf44c14"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Parse IOC CSV File -> Create Indicators",
            "targetStep": "\/api\/3\/workflow_steps\/65dcb4f3-dd15-4931-978a-1c4e6eec27fb",
            "sourceStep": "\/api\/3\/workflow_steps\/da91461c-0bd3-4c90-9c66-ab67218e6530",
            "label": null,
            "isExecuted": false,
            "uuid": "79117c8e-bb14-4684-bae8-5681ebffee26"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Start -> Configuration",
            "targetStep": "\/api\/3\/workflow_steps\/182526de-8f46-4e62-a7fd-ec2d0e3795e8",
            "sourceStep": "\/api\/3\/workflow_steps\/1d88a68a-c865-4d62-9e1d-c5e1b87e2591",
            "label": null,
            "isExecuted": false,
            "uuid": "afdc8b62-e4a5-48a6-a1d6-7106b1e0cde2"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Configuration -> Download IOCs File",
            "targetStep": "\/api\/3\/workflow_steps\/4032d19b-e2ff-4541-a9c6-d53dc207841c",
            "sourceStep": "\/api\/3\/workflow_steps\/182526de-8f46-4e62-a7fd-ec2d0e3795e8",
            "label": null,
            "isExecuted": false,
            "uuid": "e7287b93-6dcc-4fa2-8b4d-680cbcfe9177"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Hunt Sunburst IOCs -> Create Alert",
            "targetStep": "\/api\/3\/workflow_steps\/a05be9a3-f456-4619-88c4-79d83ce5d92c",
            "sourceStep": "\/api\/3\/workflow_steps\/c2dcd299-db00-40c7-bcba-7068ce37e7ee",
            "label": null,
            "isExecuted": false,
            "uuid": "4362e5a6-bb83-46ac-951e-1ee25c8330ed"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Create Alert -> Create Communication Record",
            "targetStep": "\/api\/3\/workflow_steps\/f01efd3c-2681-44d5-abc8-c2f7223cdff7",
            "sourceStep": "\/api\/3\/workflow_steps\/a05be9a3-f456-4619-88c4-79d83ce5d92c",
            "label": null,
            "isExecuted": false,
            "uuid": "c75c4169-e779-4905-b13c-2274507f1842"
        }
    ],
    "priority": "\/api\/3\/picklists\/2b563c61-ae2c-41c0-a85a-c9709585e3f2",
    "uuid": "367e46bc-6d9a-43ae-8ed4-d955f19c8483",
    "recordTags": [
        "sunburst"
    ],
    "id": 326,
    "createUser": "\/api\/3\/people\/3451141c-bac6-467c-8d72-85e0fab569ce",
    "createDate": 1636537437,
    "modifyUser": "\/api\/3\/people\/3451141c-bac6-467c-8d72-85e0fab569ce",
    "modifyDate": 1636537437,
    "owners": [],
    "isPrivate": false
}